<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kdt.finalproject.mapper.MypageMapper">


  <resultMap id="map" type="com.kdt.finalproject.vo.CwriteVO">
    <id property="cw_idx" column="cw_idx"/>
    <association property="cvo" javaType="com.kdt.finalproject.vo.CarVO"
      select="get_car" column="c_idx"/>
  </resultMap>

  <resultMap id="map2" type="com.kdt.finalproject.vo.BbslogVO">
    <id property="bl_idx" column="bl_idx"/>
    <association property="bvo" javaType="com.kdt.finalproject.vo.BbsVO"
      select="search_q" column="b_idx"/>
  </resultMap>

  <resultMap id="map3" type="com.kdt.finalproject.vo.BbslogVO">
    <id property="bl_idx" column="bl_idx"/>
    <association property="bvo" javaType="com.kdt.finalproject.vo.BbsVO"
      select="search_r" column="b_idx"/>
  </resultMap>

  <resultMap id="map4" type="com.kdt.finalproject.vo.SwriteVO">
    <id property="sw_idx" column="sw_idx"/>
    <association property="svo" javaType="com.kdt.finalproject.vo.ServiceVO"
      select="search_s" column="s_idx"/>
  </resultMap>
  

  <!-- select -->

  <select id="getMemberByIdx" resultType="com.kdt.finalproject.vo.MemVO" parameterType="String">
        SELECT * FROM member_t 
        WHERE m_idx = #{mIdx}
    </select>


  <select id="search_cw_list" resultMap="map" parameterType="String">
    SELECT * FROM car_write
    WHERE m_idx = #{m_idx}
  </select>

  <select id="search_bl_list" resultMap="map2" parameterType="String">
    SELECT * FROM bbslog
    WHERE m_idx = #{m_idx}
  </select>

  <select id="search_bl_list2" resultMap="map3" parameterType="String">
    SELECT * FROM bbslog
    WHERE m_idx = #{m_idx}
  </select>

  <select id="search_su_list" resultMap="map4" parameterType="String">
    SELECT * FROM service_use
    WHERE c_idx = #{c_idx}
  </select>

  <select id="get_car" resultType="com.kdt.finalproject.vo.CarVO" parameterType="String">
    SELECT * FROM car_t
    WHERE c_idx = #{c_idx}
  </select>

  <select id="search_q" resultType="com.kdt.finalproject.vo.BbsVO" parameterType="String">
  select * from bbs_t
  where b_idx = #{b_idx} and b_type = 2
  </select>

  <select id="search_r" resultType="com.kdt.finalproject.vo.BbsVO" parameterType="String">
  select * from bbs_t
  where b_idx = #{b_idx} and b_type = 1
  </select>

  <select id="search_s" resultType="com.kdt.finalproject.vo.ServiceVO" parameterType="String">
  select * from service_t
  where s_idx = #{s_idx}

  </select>


  <!-- insert -->
  <insert id="addCar" parameterType="com.kdt.finalproject.vo.CarVO" useGeneratedKeys="true" keyProperty="c_idx">
      insert into car_t (c_idx, c_num, c_name, c_type, c_chargetype, c_state, c_city, car_tcol) 
      values (#{c_idx}, #{c_num}, #{c_name}, #{c_type}, # {c_chargetype}, #{c_state}, #{c_city}, #{car_tcol}) 
  </insert>

  <insert id="addCarWrite" parameterType="com.kdt.finalproject.vo.CwriteVO">
      insert into car_t (cw_idx, cw_type, m_idx, c_idx, cw_date)
      values (#{cw_idx}, 0, #{m_idx}, #{c_idx}, now())
  </insert>

  <!-- update -->
  <update id="updateCar" parameterType="com.kdt.finalproject.vo.CarVO">
      UPDATE car_t
      SET c_num = #{c_num}, 
        c_name = #{c_name}, 
        c_type = #{c_type}, 
        c_chargetype = #{c_chargetype}, 
        c_state = #{c_state}, 
        c_city = #{c_city}, 
        car_tcol = #{car_tcol}
      WHERE c_idx = #{c_idx}
    </update>

  <update id="updateCarWrite" parameterType="com.kdt.finalproject.vo.CwriteVO">
      UPDATE car_write
      SET cw_type = 1
      WHERE c_idx = #{c_idx} and m_idx = #{m_idx}
  </update>

  <update id="updateMember" parameterType="com.kdt.finalproject.vo.MemVO">
        UPDATE member_t
        SET m_email = #{mEmail}, m_pw = #{mPw}, m_name = #{mName}, m_phone = #{mPhone}, m_address = #{mAddress}, m_class = #{mClass}, m_status = #{mStatus},
            m_atoken = #{mAtoken}, m_rtoken = #{mRtoken}, m_payment = #{mPayment}, m_date = #{mDate}
        WHERE m_idx = #{mIdx}
    </update>

</mapper>